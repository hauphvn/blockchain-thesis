__smjsonp__([3],{239:function(t,n,e){(function(n){function r(){var t=this,n=null;t.get=function(){return t.requestPromise?t.requestPromise:t.requestPromise=new Promise(function(e,r){if(t.config)return e(t.config);var f=c.urls.war_config,l=c.war_endpoint,d=a.getContactId();(new i).withEndpoint(l).withPath(f).ap("s",o.get("_smapp")+o.get("_smid")).ap("u",d.smuuid).ap("d",window.location.host+window.location.pathname).ajaxGet().then(function(r){n&&(clearTimeout(n),n=null,t.config=u.from(r),e(t.config))}).catch(function(){r()}),n=setTimeout(function(){r()},s.WAR_CONFIG_REQUEST_TIMEOUT)})}}var i=e(3),o=e(5),c=e(1),u=e(8),a=e(2),s=e(30);t.exports=new r}).call(n,e(0))},240:function(t,n,e){(function(n){function r(){var t=this,n=null;t.report=function(e){return new Promise(function(r,s){var f=c.urls.war_report,l=c.war_endpoint,d=u.getContactId(),h={s:o.get("_smapp")+o.get("_smid"),id:e.id,smuuid:d.smuuid,smclient:d.smclient};return h.rr=e.rr,t.request=(new i).withEndpoint(l).withPath(f).apo(h).ajaxPost().then(function(t){n&&(clearTimeout(n),n=null,r(t))}).catch(function(){s()}),n=setTimeout(function(){s()},a.WAR_REPORT_REQUEST_TIMEOUT),t.request})}}var i=e(3),o=e(5),c=e(1),u=e(2),a=e(30);t.exports=new r}).call(n,e(0))},244:function(t,n,e){(function(n){var r=e(239),i=e(57),o=e(7),c=e(30),u=function(t,n){var e=JSON.parse(JSON.stringify(t));e.rr=n.rr,e.rrId=n.id;var r="AFTER_X_SECONDS"==n.cfg.st?1e3*n.cfg.v:0;switch(e.warAction=n.cfg,n.cfg.at){case"sp":e.cfg.exit=n.cfg.onExit,e.cfg.delay=r,"BASIC"!==e.type&&(e.exit=!1,e.delayValue=0,e.delay=!1);break;case"scf":case"scc":case"sci":e.delayValue=r}return e},a=function(t,n,e,r){if(n&&t.war[e]){var i=n.map(function(n){var i=(r||t.war[e]).filter(function(t){return n.itemId==t.id})[0];return i&&(i=u(i,n)),i}).filter(function(t){return t&&t.rr}),o=t[e].filter(function(n){return-1===t.war[e].findIndex(function(t){return t.id===n.id})});"f"===e?t.f=i.length?i:o:t[e]=i.concat(o)}};t.exports=function(){var t,n=!1;return{getRunner:function(){return t||this.initRunner()},initRunner:function(){var e,u=new Promise(function(t){e=setTimeout(function(){t()},c.WAR_PROCESSING_TIMEOUT)}),s={},f=new Promise(function(t){if(n)return t(n);u.then(function(){i.get().then(function(n){t(n)})}),s.run=function(i){o.isNotNull(i.war)?(r.get().then(function(r){n||(i.war&&(a(i,r.sp,"p",i.war.p.concat(i.war.pp)),a(i,r.scc.concat(r.sci),"c",i.c),a(i,r.scf,"f")),n=i,t(n),clearTimeout(e))},function(){clearTimeout(e),t(i)}),u.then(function(){t(i)})):t(i)}});return s.processed=f,t=s}}}()}).call(n,e(0))},245:function(t,n,e){var r=e(246);t.exports={isWarAction:function(t){return t.rr},modifyPopupConfig:function(t,n){n.rr=t.rr,n.rrId=t.rrId,"BASIC"!==t.type&&(n.popupCfg=t)},scheduleChatActions:function(t,n,e){return r.scheduleChatActions(t,n,e)},getChatToDisplayImmediately:function(t){return r.getChatToDisplayImmediately(t)}}},246:function(t,n,e){var r=e(240),i=function(){var t=this;t.enabled=!0,t.ACTION_INTERVAL=1e4};i.prototype.enqueue=function(t,n){var e=this;return new Promise(function(r,i){e.enabled&&(0===n.delayValue?c(t,n).then(function(){r()},function(){i()}):setTimeout(function(){e.enabled&&c(t,n).then(function(){r()},function(){i()})},n.delayValue))})},i.prototype.setOnStateChange=function(t,n){this.enabled=!t||"fake-conversation"==t};var o=function(t){return'<div align="'+t.align+'">'+t.text+"</div>"},c=function(t,n){return new Promise(function(e,r){switch(n.warAction.at){case"scc":t.showWithMessage(o(n.warAction.content)).then(function(t){!0===t&&e(),!1===t&&r()});break;case"sci":var i=t.setBanner({html:o(n.warAction.content)});!0===i&&e(),!1===i&&r()}})},u=function(){var t=this;t.scheduler=new i,t.setOnStateChange=this.scheduler.setOnStateChange};u.prototype.scheduleChatActions=function(t,n,e){var i=this;e.setOnStateChange=i.setOnStateChange,i.scheduler.enabled=!e.state.enabled,setTimeout(function(){n.c.filter(function(t){return t.warAction&&e.chatId==t.id}).forEach(function(t){i.scheduler.enqueue(e,t).then(function(){r.report({rr:t.rr,id:t.rrId})})})})},u.prototype.getChatToDisplayImmediately=function(t){return t.c.filter(function(t){return t.rr})},t.exports=new u},247:function(t,n,e){var r=e(248),i=e(239),o=e(240);t.exports={run:function(){i.get().then(function(t){t.ecs.forEach(function(t){r.schedule(t.cfg.scr,{delay:"IMMEDIATELY"!==t.cfg.st?1e3*t.cfg.v:0}).then(function(){o.report({rr:t.rr,id:t.id})})})})}}},248:function(module,exports){var CustomScriptExecutor=function(){};CustomScriptExecutor.prototype.execute=function(script){eval(script)},CustomScriptExecutor.prototype.schedule=function(t,n){var e=this;return new Promise(function(r){"number"==typeof n.delay&&n.delay>0?setTimeout(function(){r(),e.execute(t)},n.delay):(r(),e.execute(t))})},module.exports=new CustomScriptExecutor},56:function(t,n,e){t.exports=new function(){this.Config=e(239),this.Properties=e(30),this.QueueModifier=e(244),this.Reporter=e(240),this.Utils=e(245),this.WarCSExecutor=e(247)}}});