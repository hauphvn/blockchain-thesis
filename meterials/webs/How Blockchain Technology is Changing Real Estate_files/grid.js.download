/*!
 * Version: 0.3.0
 * Updated: 2019-10-10
 */
var grid=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";t.exports=function(t,e){return t.indexOf(e)>-1}},function(t,e,r){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,r){"use strict";t.exports=function(t){return null===t}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(4)),o=r(5);t.exports=function(){var t=new o.Grid;new i.default(t);return{fetchBids:t.fetchBids.bind(t),getCreativeById:t.getCreativeById.bind(t),que:t.que,renderAd:t.renderAd.bind(t)}}()},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(0)),o=function(){function t(e,r){var n=this;void 0===r&&(r=window),this.app=e,this.win=r,this.requestDataMap={},this.setRequestData=function(t,e){n.requestDataMap[t]=e},this.getRequestDataByRequestId=function(t){return n.requestDataMap[t]||{}},this.printData=function(e,r){var i=n.getRequestDataByRequestId(e);n.output.log("REQUEST ID: "+e+"\nREQUEST: "+t.prettifyData(i)+"\nRESPONSE: "+t.prettifyData(r))},this.isOnDebugMode()&&(this.output=console,this.subscribe())}return t.prettifyData=function(t){return JSON.stringify(t,void 0,4)},t.prototype.isOnDebugMode=function(){return i.default(this.win.location.hash,"grid_debug")},t.prototype.subscribe=function(){this.app.on("fetchBidsStarted",this.setRequestData),this.app.on("fetchBidsFinished",this.printData)},t}();e.default=o},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=s(r(6)),a=s(r(7)),c=s(r(8)),d=s(r(9)),f=s(r(10)),p=s(r(18)),h=s(r(19)),l=s(r(1)),v=s(r(20)),m=s(r(21)),y=s(r(22)),g=s(r(23)),b=s(r(24)),x=function(t){function e(r){void 0===r&&(r=window);var n=t.call(this)||this;return n.win=r,n.que=[],n.counter=0,n.bidResponses={},n.requestCount=1,r&&r.grid&&r.grid.que&&(n.que=window.grid.que),n.que.push=function(t){return t(),0},r.addEventListener("message",e.safeFrameRenderHandler),n.processQueue(),n}return i(e,t),e.safeFrameRenderHandler=function(t){var e=t.data,r=t.source;try{var n=JSON.parse(e),i=n.message,o=n.gridId;if("gridSafeFrameRender"===i){var s=window.grid;if(s){var u=s.getCreativeById&&s.getCreativeById(o),a=JSON.stringify({creative:u,message:"gridSafeFrameRender"});r.postMessage(a,"*")}}}catch(t){}},e.prototype.fetchBids=function(t,e){var r,n=this;if(void 0===e&&(e=f.default),!y.default(t))throw new Error("Params should be an object");try{r=this.getQueryParams(t,this.win)}catch(t){}if(!y.default(r)||!l.default(t.callback)||!g.default(t.endpoint))throw new Error("Wrong params for fetchBids");var i=this.getRequestId();this.emit("fetchBidsStarted",[i,t.adUnits]);var o=[],s=function(e,r){n.emit("fetchBidsFinished",[i,o]),t.callback(e,r)};try{e({method:"GET",queryParams:r,timeout:t.timeout||3e3,url:t.endpoint,withCredentials:!0},function(e,r){if(e)s("Network error: "+e);else{try{o.push.apply(o,n.parseServerResponse(t,r))}catch(t){return void s("Can't parse the server's response")}var i=void 0;try{i=n.registerBidsAndFormResponse(o)}catch(t){return void s("Can't form the server targeting")}s(null,i)}})}catch(t){s("Can't initiate network request: "+t)}},e.prototype.renderAd=function(t,e){var r=this.bidResponses[t];if(!r)throw new Error("Can't find bid with id: "+t);e.write(r.html)},e.prototype.getCreativeById=function(t){var e=this.bidResponses[t];return e&&e.html},e.prototype.processQueue=function(){var t=this;setTimeout(function(){t.que.forEach(function(t){try{t()}catch(t){console.log("grid: error occured while running a command from queue",t)}})},0)},e.prototype.registerCreative=function(t){var e=""+this.counter++;return this.bidResponses[e]=t,e},e.prototype.registerBidsAndFormResponse=function(t){var e=this,r={};return t.forEach(function(t){if(!t.error){var n=t.adUnit,i=t.dealId,o=t.size,s=o[0],u=o[1],a=t.cpmAfterRounding,c={gridId:e.registerCreative(t),gridPb:a,gridSize:s+"x"+u};i&&(c.gridDealId=i),r[n]=c}}),r},e.prototype.parseServerResponse=function(t,e){var r=this,n=[],i=JSON.parse(e).seatbid;return p.default(t.adUnits,function(e,s){var u=e.bids,c=e.size;return r.validateSize(c)&&(c=[c]),u.forEach(function(e){var u,d=e.id,f={adUnit:s};if(v.default(i)){var p=a.default(i,function(t,e){var r=t.bid[0];u=e;var n=r.auid,i=r.w,s=r.h,p=a.default(c,function(t){var e=t[0],r=t[1];return e===i&&r===s});return p||(f=o({},f,{error:"SIZE MISMATCH"})),r&&p&&n===d});if(p){i.splice(u,1);var h=p.bid[0],l=r.validateBid(h);f=l?o({},f,{error:"Invalid response: "+l}):{adUnit:s,cpmAfterRounding:b.default(h.price,t.bucketsConfig),cpmBeforeRounding:h.price,dealId:h.dealid,html:h.adm,size:[h.w,h.h]}}}else f=o({},f,{error:"NO BID"});n.push(f)}),!0}),n},e.prototype.validateSize=function(t){return h.default(t)&&m.default(t[0])&&m.default(t[1])},e.prototype.validateBid=function(t){return t.price?t.auid?t.w&&t.h?t.adm?void 0:"NO ADM":"NO SIZE":"NO AUID":"NO PRICE"},e.prototype.getQueryParams=function(t,e){var r=this,n=[],i=[];if(p.default(t.adUnits,function(t){return t.bids.forEach(function(e){var o=e.id;if(n.push(o),r.validateSize(t.size)){var s=t.size,a=s[0]+"x"+s[1];u.default(i,a)||i.push(a)}else{t.size.forEach(function(t){if(r.validateSize(t)){var e=t[0]+"x"+t[1];u.default(i,e)||i.push(e)}})}}),!0}),0===n.length)throw new Error("Can't find auids for an ad request");return{auids:n.join(","),keywords:t.keyWords||null,libv:"0.3.0",r:String(c.default()),sizes:i.join(","),u:e.location.href}},e.prototype.getRequestId=function(){return this.requestCount++},e}(d.default);e.Grid=x},function(t,e,r){"use strict";t.exports=function(t,e){return-1!==t.indexOf(e)}},function(t,e,r){"use strict";t.exports=function(t,e){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(e(i,r))return i}return null}},function(t,e,r){"use strict";t.exports=function(){return Math.round(Date.now()/1e3)}},function(t,e,r){"use strict";var n=function(){function t(){this.events={}}return t.prototype.on=function(t,e){if(this.events[t]){if(-1!==(r=this.events[t]).indexOf(e))throw new Error('This handler has already been subcribed for "'+t+'" event');r.push(e)}else{var r;(r=[]).push(e),this.events[t]=r}},t.prototype.off=function(t,e){var r=this.events[t],n=r.indexOf(e);-1!==n&&r.splice(n,1)},t.prototype.emit=function(t,e){void 0===e&&(e=[]);var r=this.events[t];r&&r.map(function(t){e?t.apply(void 0,e):t()})},t}();t.exports=n},function(t,e,r){"use strict";var n=r(11),i=r(14);t.exports=function(t,e){window.XDomainRequest?i(t,new n,e):i(t,new XMLHttpRequest,e)}},function(t,e,r){"use strict";var n=r(12),i=r(13),o=r(1),s=4,u=200,a={},c=function(){function t(){var e=this;this.addEventListener=i,this.removeEventListener=i,this.setRequestHeader=i,this.overrideMimeType=i,this.onTimeout=function(){o(e.ontimeout)&&e.ontimeout(),e.destroy()},this.onError=function(){o(e.onerror)&&e.onerror(),e.destroy()},this.onLoad=function(){e.readyState=s,e.responseText=e.xdr.responseText,e.status=u,o(e.onreadystatechange)&&e.onreadystatechange(),o(e.onload)&&e.onload(),e.destroy()},this.id=t.getID(),this.xdr=new window.XDomainRequest,this.xdr.onerror=this.onError,this.xdr.ontimeout=this.onTimeout,this.xdr.onprogress=i,this.xdr.onload=this.onLoad,a[this.id]=this.xdr}return t.prototype.dispatchEvent=function(){return!1},t.prototype.open=function(t,e){this.xdr.open(t,e)},t.prototype.send=function(t){var e=this;this.xdr.timeout=this.timeout,setTimeout(function(){e.xdr.send(t)},0)},t.prototype.getResponseHeader=function(){return""},t.prototype.getAllResponseHeaders=function(){return""},t.prototype.abort=function(){this.xdr.abort(),this.destroy()},t.prototype.destroy=function(){delete a[this.id]},t.getID=n(),t}();t.exports=c},function(t,e,r){"use strict";t.exports=function(){var t=0;return function(){return""+t++}}},function(t,e,r){"use strict";t.exports=function(){}},function(t,e,r){"use strict";var n=r(15);t.exports=function(t,e,r){var i=t.method,o=t.data,s=t.headers,u=t.timeout,a=t.withCredentials,c=t.queryParams,d=t.url;if(c&&(d=n(d,c)),e.open(i,d),s)for(var f in s)s.hasOwnProperty(f)&&e.setRequestHeader(f,s[f]);a&&(e.withCredentials=Boolean(a)),u&&(e.timeout=u),e.onreadystatechange=function(){4===e.readyState&&(e.status>=200&&e.status<300||304===e.status?r&&r(void 0,e.responseText):0!==e.status&&r&&r("error: "+e.status))},e.onerror=function(){r("error")},e.ontimeout=function(){r("timeout")},e.onabort=function(){r("aborted")},e.send(o)}},function(t,e,r){"use strict";var n=r(0),i=r(16);t.exports=function(t,e){var r=i(e);return 0===r.length?t:t+(n(t,"?")?"&":"?")+r}},function(t,e,r){"use strict";var n=r(2),i=r(17);t.exports=function(t){var e=Object.keys(t),r=[];return e.forEach(function(e){var o=t[e];n(o)||i(o)||r.push(e+"="+encodeURIComponent(t[e]))}),r.join("&")}},function(t,e,r){"use strict";t.exports=function(t){return void 0===t}},function(t,e,r){"use strict";t.exports=function(t,e){for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r,t))return}},function(t,e,r){"use strict";t.exports=Array.isArray},function(t,e,r){"use strict";var n=r(2);t.exports=function(t){return!n(t)&&"object"==typeof t&&Object.keys(t).length>0}},function(t,e,r){"use strict";t.exports=function(t){return"number"==typeof t}},function(t,e,r){"use strict";t.exports=function(t){var e=typeof t;return"object"===e&&null!=t||"function"===e}},function(t,e,r){"use strict";t.exports=function(t){return"string"==typeof t}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(25)),o=[{increment:.01,max:3,min:0,precision:2},{increment:.05,max:10,min:3,precision:2},{increment:.1,max:20,min:10,precision:2},{increment:.5,max:35,min:20,precision:2},{increment:1,max:100,min:35,precision:2}];e.default=function(t,e){return void 0===e&&(e=o),i.default(t,e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(0===e.length)throw new Error("No buckets");if(t<0)throw new Error("Cpm must be >= 0");var r,n,i;e.forEach(function(t){if(void 0===t.min||void 0===t.max||void 0===t.increment||void 0===t.precision||t.min>t.max||t.min<0||t.max<0||t.increment<=0||t.precision<=1)throw new Error("Invalid buckets structure")});for(var o=0;o<e.length;o++){if(t>=(i=e[o]).min&&t<i.max){r=i;break}t>i.max&&(void 0===n||i.max>n.max)&&(n=i)}if(void 0===r){if(void 0===n)throw new Error("Cant find a matching bucket");return n.max.toFixed(n.precision)}var s=i.precision,u=i.increment,a=i.min,c=Math.pow(10,s+2),d=(t*c-a*c)/(u*c),f=Math.floor(d)*u+a;return(f=Number(f.toFixed(10))).toFixed(s)}}]);